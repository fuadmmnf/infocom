(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{6606:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-form",{staticClass:"q-gutter-md",on:{submit:function(e){void 0===t.complain.status?t.createComplain():t.updateComplain(!0)},reset:function(e){t.complain={}}}},[t.isAuthenticated&&void 0===t.complain.status?s("div",{staticClass:"row items-center"},[s("q-input",{staticClass:"col-md-3 col-xs-5  q-my-xs q-px-xs",attrs:{filled:"",label:"Search Customer"},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}}),s("q-btn",{attrs:{flat:"",label:"search",type:"button"},on:{click:t.searchCustomer}})],1):t._e(),s("div",{staticClass:"row"},[s("q-input",{staticClass:"col-md-6 col-xs-12  q-my-xs q-px-xs",attrs:{filled:"",label:"Full Name",disable:t.statusIndex>0,readonly:t.isAuthenticated},model:{value:t.complain.name,callback:function(e){t.$set(t.complain,"name",e)},expression:"complain.name"}}),s("q-input",{staticClass:"col-md-6 col-xs-12  q-my-xs q-px-xs",attrs:{filled:"",label:"Phone",disable:t.statusIndex>0,readonly:t.isAuthenticated},model:{value:t.complain.phone,callback:function(e){t.$set(t.complain,"phone",e)},expression:"complain.phone"}})],1),s("div",{staticClass:"row q-my-none"},[s("q-input",{staticClass:"col-md-6 col-xs-12 q-my-xs q-px-xs",attrs:{filled:"",type:"email",label:"Email",disable:t.statusIndex>0,readonly:t.isAuthenticated},model:{value:t.complain.email,callback:function(e){t.$set(t.complain,"email",e)},expression:"complain.email"}}),s("q-select",{staticClass:"col-md-6 col-xs-12 q-my-xs q-px-xs",attrs:{filled:"",options:t.$store.getters.getHelpTopics,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Help Topic",disable:t.statusIndex>0},model:{value:t.complain.helptopic_id,callback:function(e){t.$set(t.complain,"helptopic_id",t._n(e))},expression:"complain.helptopic_id"}})],1),t.$store.getters.getDepartments.length?s("div",{staticClass:"row q-my-none"},[s("q-select",{staticClass:"col-md-6 col-xs-12 q-my-xs q-px-xs",attrs:{filled:"",options:[{label:"Agent Create",value:"agent"},{label:"Customer Email",value:"email"}],"emit-value":"",label:"Ticket Source",disable:t.statusIndex>0},model:{value:t.complain.ticket_source,callback:function(e){t.$set(t.complain,"ticket_source",e)},expression:"complain.ticket_source"}}),s("q-select",{staticClass:"col-md-6 col-xs-12 q-my-xs q-px-xs",attrs:{filled:"",options:t.$store.getters.getDepartments,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"Department",disable:t.statusIndex>0},model:{value:t.complain.department_id,callback:function(e){t.$set(t.complain,"department_id",t._n(e))},expression:"complain.department_id"}})],1):t._e(),t.$store.getters.getSLAPlans.length?s("div",{staticClass:"row q-my-none"},[s("q-select",{staticClass:"col-md-6 col-xs-12 q-my-xs q-px-xs",attrs:{filled:"",options:t.$store.getters.getSLAPlans,"option-label":"name","option-value":"id","emit-value":"","map-options":"",label:"SLA Plan",disable:t.statusIndex>0},model:{value:t.complain.slaplan_id,callback:function(e){t.$set(t.complain,"slaplan_id",t._n(e))},expression:"complain.slaplan_id"}}),s("q-select",{staticClass:"col-md-6 col-xs-12 q-my-xs q-px-xs",attrs:{filled:"",options:[{label:"Low",value:"low"},{label:"Medium",value:"medium"},{label:"High",value:"high"},{label:"Urgent",value:"urgent"}],"emit-value":"",label:"Priority",disable:t.statusIndex>0},model:{value:t.complain.priority,callback:function(e){t.$set(t.complain,"priority",e)},expression:"complain.priority"}})],1):t._e(),t.$store.getters.getDepartments.length?s("q-input",{staticClass:" q-my-xs q-px-xs",attrs:{filled:"",type:"textarea",autogrow:"",label:"Complain Summary",disable:t.statusIndex>0},model:{value:t.complain.complain_summary,callback:function(e){t.$set(t.complain,"complain_summary",e)},expression:"complain.complain_summary"}}):t._e(),s("q-input",{staticClass:" q-my-xs q-px-xs",attrs:{filled:"",type:"textarea",autogrow:"",label:"Complain details",disable:t.statusIndex>0},model:{value:t.complain.complain_text,callback:function(e){t.$set(t.complain,"complain_text",e)},expression:"complain.complain_text"}}),t.statusIndex>1?s("q-input",{staticClass:" q-my-xs q-px-xs",attrs:{filled:"",type:"textarea",autogrow:"",label:"Complain Feedback",disable:t.statusIndex>3||!t.isComplainEditor},model:{value:t.complain.complain_feedback,callback:function(e){t.$set(t.complain,"complain_feedback",e)},expression:"complain.complain_feedback"}}):t._e(),void 0===t.complain.status?s("div",[s("q-btn",{staticClass:" q-mr-sm",attrs:{label:"Reset",type:"reset"}}),s("q-btn",{staticClass:"bg-purple text-white",attrs:{label:"Submit",type:"submit",disable:t.$store.getters.getActionRunningState}})],1):0===t.statusIndex?s("div",[s("q-btn",{staticClass:"bg-info text-white q-mr-sm",attrs:{label:"Save",type:"button",disable:t.$store.getters.getActionRunningState},on:{click:function(e){return t.updateComplain(!1)}}}),s("q-btn",{staticClass:"bg-purple text-white",attrs:{label:"Submit",type:"submit",disable:t.$store.getters.getActionRunningState}})],1):1===t.statusIndex&&void 0!==t.$store.getters.getUser.support_agent?s("div",[s("q-select",{staticClass:"col-md-6 col-xs-8 q-my-xs q-px-xs",attrs:{filled:"",options:t.supportagents.filter((function(e){return e.department_id===t.complain.department_id})),"option-label":function(t){return void 0===t.user?"":t.user.name+" ("+t.user.phone+")"},"option-value":"id","emit-value":"","map-options":"",label:"Editor",disable:t.statusIndex>1||!t.hasTeamLeaderPermission},model:{value:t.complain.editor_id,callback:function(e){t.$set(t.complain,"editor_id",t._n(e))},expression:"complain.editor_id"}}),s("q-btn",{staticClass:"bg-purple text-white",attrs:{"no-caps":"",label:"Confirm Ticket",type:"submit",disable:t.$store.getters.getActionRunningState}})],1):2===t.statusIndex?s("div",[s("q-select",{staticClass:"col-md-6 col-xs-8 q-my-xs q-px-xs",attrs:{filled:"",options:t.supportagents.filter((function(e){return e.department_id===t.complain.department_id})),"option-label":function(t){return void 0===t.user?"":t.user.name+" ("+t.user.phone+")"},"option-value":"id","emit-value":"","map-options":"",label:"Editor",disable:t.statusIndex>1||!t.hasTeamLeaderPermission},model:{value:t.complain.editor_id,callback:function(e){t.$set(t.complain,"editor_id",t._n(e))},expression:"complain.editor_id"}}),s("q-btn",{staticClass:"bg-info text-white q-mr-sm",attrs:{label:"Save",type:"button",disable:t.$store.getters.getActionRunningState},on:{click:function(e){return t.updateComplain(!1)}}}),s("q-btn",{staticClass:"bg-purple text-white",attrs:{label:"Submit",type:"submit",disable:t.$store.getters.getActionRunningState}})],1):3===t.statusIndex?s("div",[s("q-btn",{staticClass:"bg-purple text-white",attrs:{label:"Approve",type:"submit",disable:t.$store.getters.getActionRunningState}})],1):t._e()],1)},i=[],l=s("ded3"),n=s.n(l),o={name:"ComplainForm",props:{existingComplain:{type:Object,default:()=>({})},supportagents:{type:Array,default:()=>[]}},data(){return{statusList:["pending","assigned","working","finished","approved"],search:"",complain:{name:"",phone:"",email:"",helptopic_id:"",complain_text:""}}},computed:{statusIndex:function(){return this.statusList.indexOf(this.complain.status)},isAuthenticated:function(){return null!==this.$store.getters.getUser&&void 0!==this.$store.getters.getUser.phone},isComplainEditor:function(){return(null===this.$store.getters.getUser||void 0!==this.$store.getters.getUser.support_agent)&&this.complain.editor_id===this.$store.getters.getUser.support_agent.id},hasTeamLeaderPermission:function(){return(null===this.$store.getters.getUser||void 0!==this.$store.getters.getUser.support_agent)&&this.$store.getters.getDepartments.find((t=>t.leader_id===this.$store.getters.getUser.support_agent.id&&t.id===this.complain.department_id))}},mounted(){void 0!==this.existingComplain.status&&(this.complain=n()(n()({},this.existingComplain),{},{name:this.existingComplain.customer.user.name,phone:this.existingComplain.customer.user.phone,email:this.existingComplain.customer.user.email})),null!==this.$store.getters.getUser&&void 0!==this.$store.getters.getUser.support_agent&&(this.complain.editor_id=this.$store.getters.getUser.support_agent.id)},methods:{searchCustomer(){this.$axios.get(`customers/${this.search}`).then((t=>{this.complain.customer_id=t.data.id,this.complain.name=t.data.user.name,this.complain.email=t.data.user.email,this.complain.phone=t.data.user.phone}))},createComplain(){this.isAuthenticated&&void 0!==this.$store.getters.getUser.callcenter_agent&&(this.complain.agent_id=this.$store.getters.getUser.callcenter_agent.id),this.$axios.post("complains",this.complain).then((t=>{201===t.status&&(this.complain={},this.$root.$emit("complain-created",t.data))}))},updateComplain(t){t&&(this.complain.status=this.statusList[this.statusList.indexOf(this.complain.status)+1],"assigned"===this.complain.status&&(this.complain.agent_id=this.isAuthenticated&&void 0!==this.$store.getters.getUser.callcenter_agent?this.$store.getters.getUser.callcenter_agent.id:null)),this.$axios.put(`complains/${this.complain.id}`,this.complain).then((t=>{this.$root.$emit("complain-updated",t.data)})).catch((e=>{t&&(this.complain.status=this.statusList[this.statusList.indexOf(this.complain.status)-1])}))}}},r=o,c=s("2877"),p=s("0378"),m=s("27f9"),d=s("9c40"),u=s("ddd8"),h=s("eebe"),g=s.n(h),x=Object(c["a"])(r,a,i,!1,null,"5e591a89",null);e["a"]=x.exports;g()(x,"components",{QForm:p["a"],QInput:m["a"],QBtn:d["a"],QSelect:u["a"]})},b0f5:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",[s("div",[s("div",{staticClass:"row justify-center q-my-md"},[s("h5",{staticClass:"text-center text-h5 q-my-md"},[t._v("Customer Complain Form")])]),s("div",{staticClass:"row justify-center q-my-md"},[s("q-card",{staticClass:"q-pa-lg",staticStyle:{"min-width":"80%"},attrs:{flat:"",bordered:""}},[s("q-card-section",[s("complain-form",{attrs:{helptopics:t.$store.getters.getHelpTopics}})],1)],1)],1)])])},i=[],l=(s("5319"),s("6606")),n={name:"CusomerComplain",components:{ComplainForm:l["a"]},data(){return{}},mounted(){this.fetchHelpTopics(),this.$root.$on("complain-created",(t=>{this.$q.notify({type:"positive",message:"Complain Submitted Successfully",position:"top-right"}),this.$router.replace({name:"home"})}))},methods:{fetchHelpTopics(){this.$axios.get("helptopics").then((t=>{this.$store.commit("setHelpTopics",t.data)})).catch((t=>console.error(t)))}}},o=n,r=s("2877"),c=s("9989"),p=s("f09f"),m=s("a370"),d=s("eebe"),u=s.n(d),h=Object(r["a"])(o,a,i,!1,null,null,null);e["default"]=h.exports;u()(h,"components",{QPage:c["a"],QCard:p["a"],QCardSection:m["a"]})}}]);